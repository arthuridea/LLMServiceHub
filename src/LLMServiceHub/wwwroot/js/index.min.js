function dateFormat(n,t){let i;const r={"Y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()};for(let t in r)i=new RegExp("("+t+")").exec(n),i&&(n=n.replace(i[1],i[1].length==1?r[t]:r[t].padStart(i[1].length,"0")));return n}function exportBlob(n,t){const u=new Blob([n],{type:"text/plain"}),r=URL.createObjectURL(u),i=document.createElement("a");i.href=r;i.download=t;document.body.appendChild(i);i.click();document.body.removeChild(i);URL.revokeObjectURL(r)}let conversations={ConvErnieTurbo:{temperature:.95,top_p:.8,penalty_score:1,stream:!1,conversation_id:"conv-turbo",message:"",model:2,user_id:"7ffe3194-2bf0-48ba-8dbd-e888d7d556d3"},ConvErnie3_5:{temperature:.95,top_p:.8,penalty_score:1,stream:!1,conversation_id:"conv-3_5",message:"",model:1,user_id:"7ffe3194-2bf0-48ba-8dbd-e888d7d556d3"},ConvErnie4_0:{temperature:.95,top_p:.8,penalty_score:1,stream:!1,conversation_id:"conv-4_0",message:"",model:3,user_id:"7ffe3194-2bf0-48ba-8dbd-e888d7d556d3"}},sendBtnClickEventHandler=function(n){let t=$("#ipt-message").val();$("#ipt-message").val("");$(Object.keys(conversations)).each(function(n,i){let f=Math.random().toString(36).slice(-8),u=conversations[i],e="#wrapper_"+i;u.message=t;u.conversation_id=`${u.conversation_id}_${f}`;let r=$(e);if(r){let s=dateFormat("HH:MM:SS",new Date),n=`rpl_${f}`,e;switch(i){case"ConvErnieTurbo":e="ernie_turbo";break;case"ConvErnie3_5":e="ernie_3_5";break;case"ConvErnie4_0":e="ernie_4_0"}const h=`
                        <div class="chat-item">
                            <div class="row align-items-end justify-content-end">
                                <div class="col col-lg-8">
                                    <div class="chat-bubble chat-bubble-me">
                                        <div class="chat-bubble-title">
                                            <div class="row">
                                                <div class="col chat-bubble-author pb-2">${"我"}</div>
                                                <div class="col-auto chat-bubble-date">${s}</div>
                                            </div>
                                        </div>
                                        <div class="chat-bubble-body">
                                            <p>${t}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <span class="avatar">我</span>
                                </div>
                            </div>
                        </div>
                        `,c=`
                         <div class="chat-item">
                             <div class="row align-items-end">
                                 <div class="col-auto">
                                     <span class="avatar">百</span>
                                 </div>
                                 <div class="col col-lg-8">
                                     <div class="chat-bubble">
                                         <div class="chat-bubble-title">
                                             <div class="row">
                                                 <div class="col chat-bubble-author pb-2">${e}</div>
                                                 <div class="col-auto chat-bubble-date" id='reply_time_${n}'></div>
                                             </div>
                                         </div>
                                         <div class="chat-bubble-body" id='reply_${n}'>
                                         </div>
                                     </div>
                                 </div>
                             </div>
                         </div>
                         `;$(h).appendTo($(r));$(c).appendTo($(r));let o=$(r).closest(".scrollable"),l=$(o).height();$(o).scrollTop(l);$.ajax(apiEndpoint,{method:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(u)}).done(function(t){if(t){$(`#reply_time_${n}`).html(dateFormat("HH:MM:SS",new Date));var i=t.result;const u=new EasyTyper({output:"",isEnd:!1,speed:20,singleBack:!1,sleep:0,type:"normal",backSpeed:40,sentencePause:!0},marked.parse(i),()=>{},t=>{$("#reply_"+n).html(`${t}`);let i=$(r).closest(".scrollable"),u=$(i).prop("scrollTop")+$("#reply_"+n).height();$(i).scrollTop(u)})}}).fail(function(t){console.log(t);$("#reply_"+n).html("发生错误")})}});n.preventDefault()};$(document).on("keyup",function(n){var t=n||window.event,i=t.which||t.keyCode||t.charCode;i==13&&sendBtnClickEventHandler(n)});$(".btn-send-message").on("click",sendBtnClickEventHandler);$(".btn-export").on("click",function(){let t=dateFormat("YYYYmmddHHMMSS",new Date),r=$(this).closest(".card"),u=$(this).data("key")+"-"+t+".txt",f=$(r).find(".chat-bubble"),n=[];n.push(`--------------${t}-------------
`);$(f).each(function(t,i){let r=$(i).find(".chat-bubble-author").text(),u=$(i).find(".chat-bubble-date").text(),f=$(i).find(".chat-bubble-body").text();n.push(`[${r}]  ${u}

`);n.push(f.trim());n.push("\r\n-------------------------------\r\n")});let i=n.join("");console.log(i);exportBlob(i,u)});